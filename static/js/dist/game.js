class ChooseCharacter{constructor(t){this.root=t,this.$choose_character=$('\n    <div class = "ac_game_choose_character">\n        <audio class="ac_game_choose_character_hutao" src="https://www.lijiamiao.top/static/audio/choose_character/hutao.mp3" type="audio/mpeg"></audio>\n        <audio class="ac_game_choose_character_shenli" src="https://www.lijiamiao.top/static/audio/choose_character/shenli.mp3" type="audio/mpeg""></audio>\n       <div class ="ac_game_choose_character_total">\n            <div class ="ac_game_item">\n                <div class="ac_game_character_left" >\n                    <div class ="ac_game_character_title">\n                        神里凌华\n                    </div>\n                    <div class ="ac_game_character_skill">\n                        <img width = "50" src = "https://www.lijiamiao.top/static/image/playground/skill/fireball.png">\n                        <div>\n                            火球术： 向指定方向发射火球，q按键施法 CD：2秒\n                        </div>\n                    </div>\n                    <div class = "ac_game_character_skill">\n                        <img width = "50" src ="https://www.lijiamiao.top/static/image/playground/skill/flash.png">\n                        <div>\n                            闪现: 向指定方向进行一段位移， f按键施法 CD: 4秒\n                        </div>\n                    </div>\n                    <div class = "ac_game_character_skill">\n                        <img width = "50" src = "https://www.lijiamiao.top/static/image/playground/skill/guangdun.jpeg">\n                        <div>\n                            光盾: 在自己附近生成光盾， 抵挡一切伤害 r按键施法 CD:8秒 有效时间: 3秒\n                        </div>\n                    </div>\n                    <div class = "ac_game_character_skill">\n                        <img width = "50" src = "https://www.lijiamiao.top/static/image/playground/skill/greenarrow.png">\n                        <div>\n                            光箭：指定一个方向，发出具有穿透效果光箭 d按键施法 CD: 8秒\n                        </div>\n                    </div>\n                </div>\n            </div>\n            <div class ="ac_game_item">\n                <div class ="ac_game_choose_character_body">\n                    <div class = "ac_game_choose_character_item">\n                        角色选择\n                    </div>\n                    <div class = "ac_game_choose_character_image">\n                        <div class = "ac_game_choose_character_image_item ac_game_choose_character_shenli">\n                            <img width = "70" src="https://www.lijiamiao.top/static/image/choose_character/shenli.jpg">\n                        </div>\n                        &ensp;&ensp;&ensp;&ensp;&ensp;&ensp;&ensp;&ensp;&ensp;&ensp;&ensp;\n                        <div class = "ac_game_choose_character_image_item ac_game_choose_character_hutao">\n                            <img width = "70" src="https://www.lijiamiao.top/static/image/choose_character/hutao.png">\n                        </div>\n                    </div>\n                </div>\n            </div>\n            <div class="ac_game_item">\n                <div class="ac_game_character_right" >\n                    <div class ="ac_game_character_title">\n                        胡桃\n                    </div>\n                    <div class ="ac_game_character_skill">\n                        <img width = "50" src = "https://www.lijiamiao.top/static/image/playground/skill/fireball.png">\n                        <div>\n                            火球术： 向指定方向发射火球，q按键施法 CD：2秒\n                        </div>\n                    </div>\n                    <div class = "ac_game_character_skill">\n                        <img width = "50" src ="https://www.lijiamiao.top/static/image/playground/skill/flash.png">\n                        <div>\n                            闪现: 向指定方向进行一段位移， f按键施法 CD: 8秒\n                        </div>\n                    </div>\n                    <div class = "ac_game_character_skill">\n                        <img width = "50" src = "https://www.lijiamiao.top/static/image/playground/skill/all_fireball.png">\n                        <div>\n                            召唤术: 向四面八方发射 10 颗火球，r键施法 CD: 8秒\n                        </div>\n                    </div>\n                    <div class = "ac_game_character_skill">\n                        <img width = "50" src = "https://www.lijiamiao.top/static/image/playground/skill/cureball.jpg">\n                        <div>\n                            天使之拥：指定一个位置产生一个光阵,给自己以及队友回复生命 d按键施法 CD: 30秒 有效时间: 2秒\n                        </div>\n                    </div>\n                </div>\n            </div>\n        </div>\n    </div>\n'),this.$choose_character_menu=this.$choose_character.find(".ac_game_choose_character_body"),this.$choose_character_image_hutao=this.$choose_character.find(".ac_game_choose_character_hutao img"),this.$choose_character_image_shenli=this.$choose_character.find(".ac_game_choose_character_shenli img"),this.$character_right=this.$choose_character.find(".ac_game_character_right"),this.$character_left=this.$choose_character.find(".ac_game_character_left"),this.$character_right.hide(),this.$character_left.hide(),this.hide(),this.root.$ac_game.append(this.$choose_character),this.$choose_character_bgm_hutao=document.getElementsByClassName("ac_game_choose_character_hutao")[0],this.$choose_character_bgm_shenli=document.getElementsByClassName("ac_game_choose_character_shenli")[0],this.start()}start(){this.add_events()}choose_character_show(){this.$choose_character_menu.show()}add_events(){let t=this;this.$choose_character_image_hutao.mouseover((function(){t.$choose_character_bgm_hutao.play(),t.$character_right.fadeIn()})),this.$choose_character_image_hutao.mouseout((function(){t.$character_right.fadeOut()})),this.$choose_character_image_shenli.mouseover((function(){t.$choose_character_bgm_shenli.play(),t.$character_left.fadeIn()})),this.$choose_character_image_shenli.mouseout((function(){t.$character_left.fadeOut()})),this.$choose_character_image_hutao.click((function(){t.hide(),t.root.playground.work="hutao",t.root.playground.show()})),this.$choose_character_image_shenli.click((function(){t.hide(),t.root.playground.work="shenli",t.root.playground.show()}))}hide(){this.$choose_character_menu.hide(),this.$choose_character.hide()}show(){this.$choose_character.show(),this.choose_character_show()}}class AcgameMenu{constructor(t){this.root=t,this.$menu=$('\n<div class ="ac_game_menu">\n   <div class = "ac_game_menu_field">\n        <div class = "ac_game_menu_item ac_game_menu_item_dan">\n        单人模式\n        </div>\n        <br>\n        <div class = "ac_game_menu_item ac_game_menu_item_shuang">\n        多人对战\n        </div>\n        <br>\n        <div class = "ac_game_menu_item ac_game_menu_item_settings">\n        设置\n        </div>\n   </div>\n</div>\n'),this.$menu.hide(),this.root.$ac_game.append(this.$menu),this.$dan=this.$menu.find(".ac_game_menu_item_dan"),this.$shuang=this.$menu.find(".ac_game_menu_item_shuang"),this.$settings=this.$menu.find(".ac_game_menu_item_settings"),this.start()}start(){this.click_events()}click_events(){let t=this;this.$dan.click((function(){t.hide(),t.root.playground.mode="danren",t.root.choose_character.show()})),this.$shuang.click((function(){t.hide(),t.root.playground.mode="duoren",t.root.choose_character.show()})),this.$settings.click((function(){"web"===t.root.settings.platform?t.root.settings.remote_logout():t.root.acwingos.api.window.close()}))}show(){this.$menu.show()}hide(){this.$menu.hide()}}let laststamp,Ac_Game_Objects=[];class AcGameObject{constructor(){Ac_Game_Objects.push(this),this.uuid=this.random_uuid(),this.is_start=!1,this.timedate=0}random_uuid(){let t="";for(let i=0;i<8;i++)t+=parseInt(Math.floor(10*Math.random()));return t}start(){}before_update(){}update(){}later_update(){}on_destory(){}destory(){this.on_destory();for(let t=0;t<Ac_Game_Objects.length;t++)if(Ac_Game_Objects[t]===this){Ac_Game_Objects.splice(t,1);break}}}let Ac_Game_Animation=function(t){for(let i=0;i<Ac_Game_Objects.length;i++){let s=Ac_Game_Objects[i];s.is_start?(s.timedate=t-laststamp,s.before_update()):(s.start(),s.is_start=!0)}for(let t=0;t<Ac_Game_Objects.length;t++){Ac_Game_Objects[t].update()}for(let t=0;t<Ac_Game_Objects.length;t++){Ac_Game_Objects[t].later_update()}laststamp=t,requestAnimationFrame(Ac_Game_Animation)};requestAnimationFrame(Ac_Game_Animation);class ChatItem{constructor(t){this.playground=t,this.$history=$('<div class="ac_game_chatitem_history">历史记录</div>'),this.$input=$('<input type ="text" class ="ac_game_chatitem_input">'),this.id=null,this.$history.hide(),this.$input.hide(),this.mode=0,this.playground.$playground.append(this.$history),this.playground.$playground.append(this.$input),this.player_id=-1,this.start()}start(){this.add_events(),this.resize()}add_events(){let t=this;this.$input.keydown((function(i){if(27===i.which)t.hide_input();else if(13===i.which){let i=t.$input.val();if(i&&-1!==t.player_id){console.log(t.player_id),t.$input.val("");let s=t.write_massage(i,t.mode);t.render_massage(s),t.playground.mps.send_chat(s,t.player_id,t.mode)}}else 17===i.which&&(t.mode=(t.mode+1)%2)})),this.$history.mousedown((function(i){let s=t.playground.plays[0];if("me"===s.character){const e=s.ctx.canvas.getBoundingClientRect();let a=(i.clientX-e.left)/t.playground.scale+s.x-.5*t.playground.width/t.playground.scale,h=(i.clientY-e.top)/t.playground.scale+s.y-.5;3===i.which&&(s.move_to(a,h),t.playground.mps.send_move_to(a,h))}}))}resize(){this.width=.2*this.playground.width,this.history_height=.3*this.playground.height,this.margin_left=(this.playground.$playground.width()-this.playground.width)/2+.02*this.playground.height,this.history_top=(this.playground.$playground.height()-this.playground.height)/2+this.playground.height/2,this.input_top=this.history_top+.02*this.playground.height+this.history_height,this.$history.css({position:"absolute",width:this.width,height:this.history_height,left:this.margin_left,top:this.history_top,color:"white","font-size":"2vh",overflow:"auto","background-color":"rgba(0, 0, 0, 0.3)","border-radius":"5px"}),this.$input.css({position:"absolute",width:this.width,height:"3vh",left:this.margin_left,top:this.input_top,color:"white","font-size":"2vh","background-color":"rgba(0, 0, 0, 0.3)"})}show_input(){this.$input.show(),this.$input.focus(),this.show_history()}hide_input(){this.$input.hide(),this.playground.GameMap.$canvas.focus()}render_massage(t){this.$history.append(t),this.$history.scrollTop(this.$history[0].scrollHeight),this.show_history()}write_massage(t,i){let s=this.playground.root.settings.username,e=null;return 0===i?e=`[[基友]${s}]:${t}`:1===i&&(e=`[[全体]${s}]:${t}`),`<div>${e}</div>`}show_history(){this.$history.fadeIn(),this.id&&clearTimeout(this.id);let t=this;this.id=setTimeout((function(){t.$history.fadeOut(),t.id=null}),3e3)}}class FireWorks extends AcGameObject{constructor(t,i,s,e,a,h,r,l,o){super(),this.x=s,this.y=e,this.radius=h,this.playground=t,this.vx=Math.cos(r),this.vy=Math.sin(r),this.move_length=l,this.speed=o,this.color=a,this.ctx=i.ctx,this.eqs=.01}update(){if(this.move_length<this.eqs)this.destory();else{let t=Math.min(this.move_length,this.speed*this.timedate/1e3);this.x+=t*this.vx,this.y+=t*this.vy,this.move_length-=t}this.render()}render(){if(!this.playground.foucs)return!1;let t=0,i=0;this.playground.focus_mode?(t=this.x-this.playground.plays[0].x+.5*this.playground.width/this.playground.scale,i=this.y-this.playground.plays[0].y+.5):(t=this.x-this.playground.focus_point_x+.5*this.playground.width/this.playground.scale,i=this.y-this.playground.focus_point_y+.5),this.ctx.beginPath(),this.ctx.arc(t*this.playground.scale,i*this.playground.scale,this.radius*this.playground.scale,0,2*Math.PI,!1),this.ctx.fillStyle=this.color,this.ctx.fill()}}class Room extends AcGameObject{constructor(t,i,s,e,a){super(),this.playground=t,this.ctx=i,this.x=s,this.y=e,this.color=a}before_update(){this.render()}render(){if(!this.playground.foucs)return!1;let t=this.playground.real_width/20,i=0,s=0;this.playground.focus_mode?(i=this.x-this.playground.plays[0].x+.5*this.playground.width/this.playground.scale,s=this.y-this.playground.plays[0].y+.5):(i=this.x-this.playground.focus_point_x+.5*this.playground.width/this.playground.scale,s=this.y-this.playground.focus_point_y+.5);let e=this.playground.scale;this.ctx.fillStyle=this.color,this.ctx.fillRect(i*e,s*e,t*e,t*e)}on_destory(){for(let t=0;t<this.playground.GameMap.rooms.length;t++){this.playground.GameMap.rooms[t]===this&&this.playground.GameMap.rooms.splice(t,1)}}}class Wall extends AcGameObject{constructor(t,i,s,e,a){super(),this.playground=t,this.ctx=i,this.x=s,this.y=e,this.color=a}before_update(){this.render()}render(){if(!this.playground.foucs)return!1;let t=this.playground.real_width/20,i=0,s=0;this.playground.focus_mode?(i=this.x-this.playground.plays[0].x+.5*this.playground.width/this.playground.scale,s=this.y-this.playground.plays[0].y+.5):(i=this.x-this.playground.focus_point_x+.5*this.playground.width/this.playground.scale,s=this.y-this.playground.focus_point_y+.5);let e=this.playground.scale;this.ctx.save(),this.ctx.beginPath(),this.ctx.lineWidth=.005*this.playground.height,this.ctx.strokeStyle=this.color,this.ctx.rect(i*e,s*e,t*e,t*e),this.ctx.stroke(),this.ctx.restore()}on_destory(){for(let t=0;t<this.playground.GameMap.walls.length;t++){this.playground.GameMap.walls[t]===this&&this.playground.GameMap.walls.splice(t,1)}}}class GameMap extends AcGameObject{constructor(t){super(),this.playground=t,this.$canvas=$("<canvas tabindex = 0></canvas>"),this.ctx=this.$canvas[0].getContext("2d"),this.playground.$playground.append(this.$canvas),this.walls=[],"duoren"===this.playground.mode&&(this.map=[[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,1,1,1,1,1,1,1,1,1,1,0,0,0,0,0],[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],[0,0,0,1,0,0,0,0,0,1,0,0,1,0,0,0,1,0,0,0],[0,0,0,1,0,0,0,0,0,0,1,0,0,1,0,0,1,0,0,0],[0,0,0,1,0,0,0,0,0,0,0,0,0,0,1,0,1,0,0,0],[0,0,0,1,0,0,0,0,0,0,1,0,0,0,0,0,1,0,0,0],[0,0,0,1,0,1,0,0,0,0,0,1,0,1,0,0,1,0,0,0],[0,0,0,1,0,0,1,0,1,0,0,0,0,0,1,0,1,0,0,0],[0,0,0,1,0,0,0,0,0,1,0,0,0,0,0,0,1,0,0,0],[0,0,0,1,0,1,0,0,0,0,0,0,0,0,0,0,1,0,0,0],[0,0,0,1,0,0,1,0,0,1,0,0,0,0,0,0,1,0,0,0],[0,0,0,1,0,0,0,1,0,0,1,0,0,0,0,0,1,0,0,0],[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,1,1,1,1,1,1,1,1,1,1,0,0,0,0,0],[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0]],this.room_x=[],this.room_y=[],this.rooms=[]),this.start()}start(){this.$canvas.focus(),this.create_walls(),"duoren"===this.playground.mode&&this.create_rooms()}create_walls(){let t=this.playground.real_width/20;for(let i=0;i<20;i++)for(let s=0;s<20;s++)this.x=i*t,this.y=s*t,this.walls.push(new Wall(this.playground,this.ctx,this.x,this.y,"rgba(255,255,255,0.5)"))}create_rooms(){let t=this.playground.real_width/20;for(let i=0;i<20;i++)for(let s=0;s<20;s++)1===this.map[i][s]&&(this.x=i*t,this.y=s*t,this.room_x.push(this.x),this.room_y.push(this.y),this.rooms.push(new Room(this.playground,this.ctx,this.x,this.y,"rgba(122,115,116,0.7)")))}resize(){this.ctx.canvas.height=this.playground.height,this.ctx.canvas.width=this.playground.width}before_update(){this.resize(),this.render()}render(){this.ctx.fillStyle="rgba(176,223,229,1)",this.ctx.fillRect(0,0,this.ctx.canvas.width,this.ctx.canvas.height)}on_destory(){for(;this.walls&&this.walls.length>0;)this.walls[0].destory();for(;this.rooms&&this.rooms.length>0;)this.rooms[0].destory()}}class GameBoard extends AcGameObject{constructor(t,i,s,e){super(),this.playground=t,this.ctx=this.playground.GameMap.ctx,this.attackee_player_img=i,this.attacked_player_img=s,this.coldtime=3,this.esp=.01,this.color=e}update(){this.coldtime-=this.timedate/1e3,this.coldtime<this.esp&&this.destory(),this.render()}render(){this.ctx.fillStyle=this.color,this.ctx.fillRect(.25*this.playground.width,.2*this.playground.height,.5*this.playground.width,.1*this.playground.height),this.ctx.beginPath(),this.ctx.arc(.25*this.playground.width,.25*this.playground.height,.05*this.playground.height,.5*Math.PI,1.5*Math.PI,!1),this.ctx.fill(),this.ctx.beginPath(),this.ctx.arc(.75*this.playground.width,.25*this.playground.height,.05*this.playground.height,.5*Math.PI,1.5*Math.PI,!0),this.ctx.fill(),this.ctx.font=.05*this.playground.height+"px '微软雅黑'",this.ctx.fillStyle="rgba(48,22,28,1)",this.ctx.textAlign="center",this.ctx.fillText("击      败",this.playground.width/2,.25*this.playground.height),this.ctx.save(),this.ctx.beginPath(),this.ctx.arc(.3*this.playground.width,.25*this.playground.height,.05*this.playground.height,0,2*Math.PI,!1),this.ctx.stroke(),this.ctx.clip(),this.ctx.drawImage(this.attackee_player_img,.3*this.playground.width-.05*this.playground.height,.25*this.playground.height-.05*this.playground.height,.1*this.playground.height,.1*this.playground.height),this.ctx.restore(),this.ctx.save(),this.ctx.beginPath(),this.ctx.arc(.7*this.playground.width,.25*this.playground.height,.05*this.playground.height,0,2*Math.PI,!1),this.ctx.stroke(),this.ctx.clip(),this.ctx.drawImage(this.attacked_player_img,.7*this.playground.width-.05*this.playground.height,.25*this.playground.height-.05*this.playground.height,.1*this.playground.height,.1*this.playground.height),this.ctx.restore()}}class KillBoard extends AcGameObject{constructor(t){super(),this.playground=t,this.ctx=this.playground.GameMap.ctx,this.time=360,this.esp=.01,this.id=this.playground.plays[0].id}update(){this.time-=this.timedate/1e3,this.time<this.esp&&this.destory(),this.render()}render(){let t=this.playground.real_width/8,i=this.playground.scale;this.ctx.font=.05*this.playground.height+"px '微软雅黑'",this.ctx.fillStyle="rgba(45,12,19,1)",this.ctx.textAlign="center";let s=this.playground.kill_cnt;this.ctx.fillText(s[this.id%2]+" : "+s[(this.id+1)%2],this.playground.width-t*i-.05*this.playground.width,.05*this.playground.height)}}class MinMap extends AcGameObject{constructor(t,i){super(),this.playground=t,this.ctx=i,this.radius=.1,this.id=-1}update(){this.render()}is_mode(t){if("duoren"===this.playground.mode&&-1!=this.id){if(t.id%2===this.id)return!0}else if("me"===t.character)return!0;return!1}render(){let t=this.playground.real_width/8,i=t,s=this.playground.scale;if(this.ctx.fillStyle="rgba(0,0,0,0.4)",this.ctx.fillRect(this.playground.width-t*s,0,t*s,i*s),this.x=this.playground.width-this.playground.real_width/8*this.playground.scale,this.y=this.playground.height-this.playground.real_height/8*this.playground.scale,"duoren"===this.playground.mode){let t=this.playground.real_width/20,i=this.playground.GameMap.room_x,e=this.playground.GameMap.room_y;for(let a=0;a<i.length;a++){this.ctx.fillStyle="rgba(54,41,47,0.7)";let h=i[a]*s/8+this.x,r=e[a]*s/8;this.ctx.fillRect(h,r,t*s/8,t*s/8)}}for(let t=0;t<this.playground.plays.length;t++){let i=this.playground.plays[t],e=i.x,a=i.y;if("me"===i.character){this.ctx.lineWidth=.005*this.playground.height,this.ctx.strokeStyle="rgba(115,87,92,1)";let t=0,i=0;this.playground.focus_mode?(t=e*s-.5*this.playground.width,i=a*s-.5*this.playground.height):(t=this.playground.focus_point_x*s-.5*this.playground.width,i=this.playground.focus_point_y*s-.5*this.playground.height),t<0&&(t=0),i<0&&(i=0),t+this.playground.width>this.playground.real_width*this.playground.scale&&(t=this.playground.real_width*s-this.playground.width),i+this.playground.height>this.playground.real_height*s&&(i=this.playground.real_height*s-this.playground.height),this.ctx.strokeRect(t/8+this.x,i/8,this.playground.width/8,this.playground.height/8)}"duoren"===this.playground.mode&&i.death_time>i.esp||("boss"!==i.username?this.is_mode(i)?(this.ctx.beginPath(),this.ctx.arc(e*s/8+this.x,a*s/8,this.radius*s/8,0,2*Math.PI,!1),this.ctx.fillStyle="green",this.ctx.fill()):(this.ctx.beginPath(),this.ctx.arc(e*s/8+this.x,a*s/8,this.radius*s/8,0,2*Math.PI,!1),this.ctx.fillStyle="red",this.ctx.fill()):(this.ctx.beginPath(),this.ctx.arc(e*s/8+this.x,a*s/8,this.radius*s/8,0,2*Math.PI,!1),this.ctx.fillStyle="yellow",this.ctx.fill()))}}}class NoticeBoard extends AcGameObject{constructor(t){super(),this.playground=t,this.ctx=this.playground.GameMap.ctx,this.text="已就绪 ： 0 人"}write(t){this.text=t}update(){this.render()}render(){this.ctx.font=.05*this.playground.height+"px '微软雅黑'",this.ctx.fillStyle="rgba(46,12,19,1)",this.ctx.textAlign="center",this.ctx.fillText(this.text,this.playground.width/2,.1*this.playground.height)}}class Player extends AcGameObject{constructor(t,i,s,e,a,h,r,l,o,n,d){super(),this.playground=t,this.color=h,this.x=i,this.y=s,this.ctx=this.playground.GameMap.ctx,this.radius=a,this.vx=0,this.vy=0,this.damage_vx=0,this.damage_vy=0,this.damage_speed=0,this.speed=e,this.character=r,this.move_length=0,this.esp=.01,this.cur_skill=null,this.flash_angle=0,this.is_flash=!1,this.spend_time=0,this.photo=o,this.username=l,this.id=n,this.fireballs=[],this.greenarrows=[],this.skill_b_time=0,this.skill_r_time=0,this.death_time=0,this.damage_doing=!1,this.skill_doing=!1,this.mouse_x=0,this.mouse_y=0,"ai"!==this.character?(this.img=new Image,this.img.src=this.photo,this.work=d,this.skill_d=null,this.skill_r=null,this.skill_r_coldtime=8,this.fireball_coldtime=2,this.flash_coldtime=8,this.skill_b_coldtime=8,this.skill_b_time=0,"me"===this.character&&("duoren"===this.playground.mode&&(this.skill_b_img=new Image,this.skill_b_img.src="https://www.lijiamiao.top/static/image/playground/skill/return_home.png"),this.fireball_img=new Image,this.fireball_img.src="https://www.lijiamiao.top/static/image/playground/skill/fireball.png",this.flash_img=new Image,this.flash_img.src="https://www.lijiamiao.top/static/image/playground/skill/flash.png","hutao"===this.work?(this.skill_r_img=new Image,this.skill_r_img.src="https://www.lijiamiao.top/static/image/playground/skill/all_fireball.png",this.skill_d_img=new Image,this.skill_d_img.src="https://www.lijiamiao.top/static/image/playground/skill/cureball.jpg",this.skill_d_coldtime=30):"shenli"===this.work&&(this.skill_r_img=new Image,this.skill_r_img.src="https://www.lijiamiao.top/static/image/playground/skill/guangdun.jpeg",this.skill_d_img=new Image,this.skill_d_img.src="https://www.lijiamiao.top/static/image/playground/skill/greenarrow.png",this.skill_d_coldtime=8))):(this.img=new Image,this.img.src="https://www.lijiamiao.top/static/image/playground/renji.jpg"),this.f=.9}search_id(){let t=[0,0,0,0,0,0];for(let i=0;i<this.playground.plays.length;i++){t[this.playground.plays[i].id]++}for(let i=0;i<6;i++)if(!t[i]){this.playground.plays[0].id=i;break}}start(){if("boss"!==this.username){if(this.playground.player_cnt++,this.playground.notice_board.write("已就绪 ："+this.playground.player_cnt+"人"),this.playground.player_cnt>=4&&(this.playground.state="fighting",this.playground.notice_board.write("Fighting"),this.search_id(),"duoren"===this.playground.mode)){let t=!1,i=!1,s=this.playground.real_width/20;for(let e=0;e<this.playground.plays.length;e++){let a=this.playground.plays[e];a.id%2==0?(a.x=2*s,a.y=2*s,i||(new CureBall(this.playground,a,a.x,a.y,360,1.5*s,"System"),i=!0)):(a.x=3-2*s,a.y=3-2*s,t||(new CureBall(this.playground,a,a.x,a.y,360,1.5*s,"System"),t=!0)),a.start_x=a.x,a.start_y=a.y}this.playground.min_map.id=this.playground.plays[0].id%2,this.playground.chatitem.player_id=this.playground.plays[0].id%2,this.playground.timeboard=new TimeBoard(this.playground),new KillBoard(this.playground)}if("me"===this.character)this.add_listening_events();else if("ai"===this.character){let t=Math.random()*this.playground.real_width,i=Math.random()*this.playground.real_height;this.move_to(t,i)}}}add_listening_events(){let t=this;this.playground.GameMap.$canvas.mousemove((function(i){const s=t.ctx.canvas.getBoundingClientRect();let e=0,a=0;t.playground.focus_mode?(e=(i.clientX-s.left)/t.playground.scale+t.x-.5*t.playground.width/t.playground.scale,a=(i.clientY-s.top)/t.playground.scale+t.y-.5):(e=(i.clientX-s.left)/t.playground.scale+t.playground.focus_point_x-.5*t.playground.width/t.playground.scale,a=(i.clientY-s.top)/t.playground.scale+t.playground.focus_point_y-.5),t.mouse_x=e,t.mouse_y=a})),this.playground.GameMap.$canvas.keydown((function(i){if("duoren"===t.playground.mode){if(13===i.which)return t.playground.chatitem.show_input(),!1;if(27===i.which)return t.playground.chatitem.hide_input(),!1}if("fighting"!==t.playground.state)return!0;if(89===i.which&&(t.playground.focus_mode=(t.playground.focus_mode+1)%2,t.playground.focus_point_x=t.x,t.playground.focus_point_y=t.y),81===i.which&&t.fireball_coldtime<t.esp)t.cur_skill="fireball",t.skill_doing=!0;else if(82===i.which&&t.skill_r_coldtime<t.esp){if(t.skill_r_coldtime=8,"hutao"===t.work)t.all_shoot_fireball();else if("shenli"===t.work&&(t.skill_r_time=3,"duoren"===t.playground.mode)){t.skill_b_time>t.esp&&(t.skill_b_time=0);let i=0,s=0,e=0;t.playground.mps.send_fireball(i,s,e,"guangdun")}}else if(70===i.which&&t.flash_coldtime<t.esp)t.cur_skill="flash",t.skill_doing=!0;else if(68===i.which&&t.skill_d_coldtime<t.esp)t.skill_d="ready",t.skill_doing=!0;else if(66===i.which&&"duoren"===t.playground.mode&&t.skill_b_coldtime<t.esp){t.skill_b_time=3,t.vx=t.vy=t.move_length=0;let i=0,s=0,e=0;t.playground.mps.send_fireball(i,s,e,"return_home")}else if(83===i.which&&(t.vx=t.vy=t.move_length=0,"duoren"===t.playground.mode)){let i=0,s=0,e=0;t.playground.mps.send_fireball(i,s,e,"stay")}})),this.playground.GameMap.$canvas.on("contextmenu",(function(){return!1})),this.playground.GameMap.$canvas.mousedown((function(i){const s=t.ctx.canvas.getBoundingClientRect();let e=0,a=0;if(t.playground.focus_mode?(e=(i.clientX-s.left)/t.playground.scale+t.x-.5*t.playground.width/t.playground.scale,a=(i.clientY-s.top)/t.playground.scale+t.y-.5):(e=(i.clientX-s.left)/t.playground.scale+t.playground.focus_point_x-.5*t.playground.width/t.playground.scale,a=(i.clientY-s.top)/t.playground.scale+t.playground.focus_point_y-.5),"fighting"!==t.playground.state)return!0;if("duoren"===t.playground.mode){let i=t.playground.real_width/20,s=t.playground.GameMap.room_x,h=t.playground.GameMap.room_y;for(let t=0;t<s.length;t++)if(s[t]<=e&&e<=s[t]+i&&h[t]<=a&&a<=h[t]+i)return!0}if(e<0||a<0||e>t.playground.real_width||a>t.playground.real_height)return!0;for(let i=0;i<20*Math.random()+10;i++){let i=Math.random()*Math.PI*2,s=.005,h=.05,r=.15;new FireWorks(t.playground,t,e,a,"rgba(0,0,0,0.7)",s,i,h,r)}if(3===i.which)t.move_to(e,a),"duoren"===t.playground.mode&&t.playground.mps.send_move_to(e,a);else if(1===i.which)if("fireball"===t.cur_skill){let i=t.shoot_fireball(e,a,.8,"rgba(250,93,25,0.8)");t.cur_skill=null,t.fireball_coldtime=2,"duoren"===t.playground.mode&&t.playground.mps.send_fireball(e,a,i.uuid,"fireball"),t.skill_doing=!1}else if("flash"===t.cur_skill)t.flash_angle=Math.atan2(a-t.y,e-t.x),t.is_flash=!0,t.flash_coldtime=8,t.skill_doing=!1;else if("ready"===t.skill_d){if("shenli"===t.work){let i=t.shoot_greenarrow(e,a);t.skill_d=null,t.skill_d_coldtime=8,"duoren"===t.playground.mode&&t.playground.mps.send_fireball(e,a,i.uuid,"greenarrow")}else if("hutao"===t.work){t.skill_d_coldtime=30;let i=t.shoot_cureball(e,a);t.skill_d=null,"duoren"===t.playground.mode&&t.playground.mps.send_fireball(e,a,i.uuid,"cureball")}t.skill_doing=!1}}))}attacked(t,i,s,e){for(let t=0;t<20*Math.random()+10;t++){let t=Math.random()*Math.PI*2,i=.01*Math.random(),s=.15*Math.random(),e=.15;new FireWorks(this.playground,this,this.x,this.y,this.color,i,t,s,e)}if("duoren"===this.playground.mode&&this.skill_b_time>this.esp&&(this.skill_b_time=0),this.radius-=i,this.radius<this.esp)return"danren"===this.playground.mode?"me"===s.character?new GameBoard(this.playground,s.img,this.img,"rgba(27,167,132,0.7)"):new GameBoard(this.playground,s.img,this.img,"rgba(191,53,83,0.7)"):"duoren"===this.playground.mode&&(this.playground.min_map.id===s.id%2?new GameBoard(this.playground,s.img,this.img,"rgba(27,167,132,0.7)"):new GameBoard(this.playground,s.img,this.img,"rgba(191,53,83,0.7)")),"danren"===this.playground.mode?this.destory():"duoren"===this.playground.mode&&("boss"!==this.username?(this.death_time=5,this.vx=this.vy=this.move_length=0):this.destory(),this.playground.kill_cnt[s.id%2]++,"me"===this.character&&(this.playground.state="over")),!1;this.speed*=this.f,"fireball"===e&&(this.damage_speed=80*i,this.damage_vx=Math.cos(t),this.damage_vy=Math.sin(t))}cureball_attacked(t){if(this.radius<.05){for(let t=0;t<20*Math.random()+10;t++){let t=Math.random()*Math.PI*2,i=.005*Math.random(),s=.1*Math.random(),e=.15,a=this.x+Math.cos(t)*s,h=this.y+Math.sin(t)*s;new FireWorks(this.playground,this,a,h,this.color,i,t,s,e)}this.radius+=t,this.speed=.15}}receive_attacked(t,i,s,e,a,h,r){"fireball"===r&&t.fireball_destory(i),"greenarrow"===r&&this.skill_r_time>this.esp&&t.greenarrow_destory(i),this.x=a,this.y=h,"cureball"!==r?this.skill_r_time<this.esp&&this.attacked(s,e,t,r):"cureball"===r&&this.cureball_attacked(e)}shoot_greenarrow(t,i){"duoren"===this.playground.mode&&this.skill_b_time>this.esp&&(this.skill_b_time=0);let s=Math.atan2(i-this.y,t-this.x);return new GreenArrow(this.playground,this,this.x,this.y,1.5,1,s,"rgb(254,215,26,0.7)")}shoot_fireball(t,i,s,e){"duoren"===this.playground.mode&&this.skill_b_time>this.esp&&(this.skill_b_time=0);let a=Math.atan2(i-this.y,t-this.x);return new FireBall(this.playground,this,this.x,this.y,s,a,.8,.01)}shoot_cureball(t,i){"duoren"===this.playground.mode&&this.skill_b_time>this.esp&&(this.skill_b_time=0);return new CureBall(this.playground,this,t,i,2,.2,"player")}all_shoot_fireball(){"duoren"===this.playground.mode&&this.skill_b_time>this.esp&&(this.skill_b_time=0);for(let t=0;t<10;t++){let i=2*Math.PI/10*t,s=this.x+Math.cos(i),e=this.y+Math.sin(i),a=.8,h="rgba(250,93,25,0.8)",r=this.shoot_fireball(s,e,a,h);"duoren"===this.playground.mode&&this.playground.mps.send_fireball(s,e,r.uuid,"fireball")}}flash(t){"duoren"===this.playground.mode&&this.skill_b_time>this.esp&&(this.skill_b_time=0);let i=this.playground.real_width/20+.1+this.esp;this.vx=this.vy=this.move_length=0;let s=this.x+i*Math.cos(t),e=this.y+i*Math.sin(t);for(;this.out_of_map(s,e);)i-=.01,s=this.x+i*Math.cos(t),e=this.y+i*Math.sin(t);this.x=s,this.y=e}get_distance(t,i,s,e){let a=t-s,h=i-e;return Math.sqrt(a*a+h*h)}move_to(t,i){"duoren"===this.playground.mode&&this.skill_b_time>this.esp&&(this.skill_b_time=0),this.move_length=this.get_distance(t,i,this.x,this.y);let s=Math.atan2(i-this.y,t-this.x);this.vx=Math.cos(s),this.vy=Math.sin(s)}out_of_map(t,i){if(t-this.radius<.1*this.esp||t+this.radius>this.playground.real_width-.1*this.esp)return!0;if(i-this.radius<.1*this.esp||i+this.radius>this.playground.real_height-.1*this.esp)return!0;if("duoren"===this.playground.mode){let s=this.playground.real_width/20,e=this.playground.GameMap.room_x,a=this.playground.GameMap.room_y;for(let h=0;h<e.length;h++)for(let r=0;r<36;r++){let l=2*Math.PI/36*r,o=t+Math.cos(l)*this.radius,n=i+Math.sin(l)*this.radius;if(e[h]<=o&&o<=e[h]+s&&a[h]<=n&&n<=a[h]+s)return!0}}return!1}return_home(){this.start_x&&this.start_y&&(this.x=this.start_x,this.y=this.start_y,this.skill_b_coldtime=8)}live_player(){this.return_home(),this.speed=.15,this.radius=.05,"me"===this.character&&(this.playground.state="fighting",this.playground.notice_board.write("Fighting"))}update_time(){this.skill_r_time>this.esp?this.skill_r_time-=this.timedate/1e3:this.skill_r_time=0,this.fireball_coldtime>this.esp?this.fireball_coldtime-=this.timedate/1e3:this.fireball_coldtime=0,this.flash_coldtime>this.esp?this.flash_coldtime-=this.timedate/1e3:this.flash_coldtime=0,this.skill_d_coldtime>this.esp?this.skill_d_coldtime-=this.timedate/1e3:this.skill_d_coldtime=0,this.skill_r_coldtime>this.esp?this.skill_r_coldtime-=this.timedate/1e3:this.skill_r_coldtime=0,this.skill_b_time>this.esp?(this.skill_b_time-=this.timedate/1e3,this.skill_b_time<this.esp&&this.return_home()):this.skill_b_time=0,this.death_time>this.esp?(this.death_time-=this.timedate/1e3,this.death_time<this.esp&&this.live_player()):this.death_time=0,this.skill_b_coldtime>this.esp?this.skill_b_coldtime-=this.timedate/1e3:this.skill_b_coldtime=0}update_win(){"fighting"===this.playground.state&&"danren"===this.playground.mode&&1===this.playground.plays.length&&"me"===this.character&&(this.playground.scoreboard.win(),this.playground.state="over"),this.playground.timeboard&&"duoren"===this.playground.mode&&0===this.playground.timeboard.time&&"me"===this.character&&this.playground.kill_cnt[this.id%2]>this.playground.kill_cnt[(this.id+1)%2]&&(this.playground.timeboard.destory(),this.playground.timeboard=null,this.playground.scoreboard.win(),this.playground.state="over"),this.playground.timeboard&&"duoren"===this.playground.mode&&0===this.playground.timeboard.time&&"me"===this.character&&this.playground.kill_cnt[this.id%2]<=this.playground.kill_cnt[(this.id+1)%2]&&(this.playground.timeboard.destory(),this.playground.timeboard=null,this.playground.scoreboard.lose(),this.playground.state="over")}update(){if(this.update_win(),this.update_time(),this.spend_time+=this.timedate/1e3,"ai"===this.character&&this.spend_time>4)if(Math.random()<.005){let t=this.playground.plays[Math.floor(Math.random()*this.playground.plays.length)],i=.8,s=this.get_distance(this.x,this.y,t.x,t.y)/(i*this.timedate/1e3),e=t.x+s*t.speed*t.timedate/1e3*t.vx,a=t.y+s*t.speed*t.timedate/1e3*t.vy;this!==t&&this.shoot_fireball(e,a,.8,"rgba(250,93,25,0.8)")}else Math.random()>.995&&this.playground.plays.length>1&&this.all_shoot_fireball();this.death_time>this.esp&&"me"===this.character&&"duoren"===this.playground.mode&&this.playground.notice_board.write("复活倒计时"+Math.floor(this.death_time)+"秒");let t=this.x,i=this.y;if(this.damage_speed>this.esp){this.vx=0,this.vy=0,this.move_length=0;let t=this.damage_speed*this.timedate/1e3;this.x+=t*this.damage_vx,this.y+=t*this.damage_vy,this.damage_speed*=this.f,this.damage_speed<=this.esp&&(this.damage_doing=!1)}else if("flash"===this.cur_skill&&this.is_flash)this.cur_skill=null,this.is_flash=!1,this.flash(this.flash_angle),"duoren"===this.playground.mode&&"me"===this.character&&this.playground.mps.send_flash(this.flash_angle);else if(this.move_length<this.esp){if(this.vx=this.vy=0,this.move_length=0,"ai"===this.character){let t=Math.random()*this.playground.real_width,i=Math.random()*this.playground.real_width;this.move_to(t,i)}}else{let t=Math.min(this.move_length,this.speed*this.timedate/1e3);this.x+=this.vx*t,this.y+=this.vy*t,this.move_length-=t}this.out_of_map(this.x,this.y)&&(this.vx=this.vy=this.move_length=this.damage_speed=0,this.x=t,this.y=i),this.render()}render(){"me"===this.character&&this.render_skill();let t=0,i=0;this.playground.focus_mode?(t=this.x-this.playground.plays[0].x+.5*this.playground.width/this.playground.scale,i=this.y-this.playground.plays[0].y+.5):(t=this.x-this.playground.focus_point_x+.5*this.playground.width/this.playground.scale,i=this.y-this.playground.focus_point_y+.5);let s=this.playground.scale;if(this.skill_doing){let e=0,a=0;this.playground.focus_mode?(e=this.mouse_x-this.playground.plays[0].x+.5*this.playground.width/this.playground.scale,a=this.mouse_y-this.playground.plays[0].y+.5):(e=this.mouse_x-this.playground.focus_point_x+.5*this.playground.width/this.playground.scale,a=this.mouse_y-this.playground.focus_point_y+.5);let h=Math.atan2(a-i,e-t),r=.05*this.playground.height;this.ctx.beginPath(),this.ctx.moveTo(e*s,a*s),this.ctx.arc(e*s,a*s,r,h-Math.PI/6-Math.PI,h+Math.PI/6-Math.PI,!1),this.ctx.fillStyle="white",this.ctx.fill(),this.ctx.beginPath(),this.ctx.lineWidth=.01*this.playground.height,this.ctx.strokeStyle="white",this.ctx.setLineDash([.04*this.playground.height,.02*this.playground.height]),this.ctx.moveTo(t*s,i*s),this.ctx.lineTo(e*s,a*s),this.ctx.stroke(),this.ctx.closePath()}if(this.death_time>this.esp)return!1;if(this.skill_r_time>this.esp&&(this.ctx.beginPath(),this.ctx.arc(t*s,i*s,.2*this.playground.height,this.radius*s,0,2*Math.PI,!1),this.ctx.fillStyle="rgba(254,215,26,0.7)",this.ctx.fill()),"ai"!==this.character?(this.ctx.save(),this.ctx.beginPath(),this.ctx.arc(t*s,i*s,this.radius*s,0,2*Math.PI,!1),this.ctx.stroke(),this.ctx.clip(),this.ctx.drawImage(this.img,(t-this.radius)*s,(i-this.radius)*s,2*this.radius*s,2*this.radius*s),this.ctx.restore()):(this.ctx.beginPath(),this.ctx.arc(t*s,i*s,this.radius*s,0,2*Math.PI,!1),this.ctx.fillStyle=this.color,this.ctx.fill()),this.skill_b_time>this.esp)for(let t=0;t<20*Math.random()+10;t++){let t=Math.random()*Math.PI*2,i=.005*Math.random(),s=.1*Math.random(),e=.15,a=this.x+Math.cos(t)*s,h=this.y+Math.sin(t)*s;new FireWorks(this.playground,this,a,h,"rgba(17,119,176,0.7)",i,t,s,e)}}render_skill(){let t=.05*this.playground.height,i=this.playground.height,s=.02*i;if(this.ctx.fillStyle="rgba(0,0,0,0.4)",this.ctx.fillRect(.5*this.playground.width-.15*this.playground.height,.86*this.playground.height,.5*this.playground.height,.14*this.playground.height),"duoren"===this.playground.mode){this.ctx.fillStyle="rgba(0,0,0,0.4)",this.ctx.fillRect(.5*this.playground.width-.27*this.playground.height,.86*this.playground.height,.12*this.playground.height,.14*this.playground.height);let i=.5*this.playground.width-.2*this.playground.height,e=.93*this.playground.height;this.skill_b_time>0?(this.ctx.save(),this.ctx.beginPath(),this.ctx.arc(i,e,t,0,2*Math.PI,!1),this.ctx.clip(),this.ctx.drawImage(this.skill_b_img,i-t,e-t,2*t,2*t),this.ctx.restore(),this.ctx.beginPath(),this.ctx.moveTo(i,e),this.ctx.arc(i,e,t,0-Math.PI/2,-this.skill_b_time/3*Math.PI*2-Math.PI/2,!0),this.ctx.fillStyle="rgba(0, 0, 255, 0.3)",this.ctx.fill()):(this.ctx.save(),this.ctx.beginPath(),this.ctx.arc(i,e,t,0,2*Math.PI,!1),this.ctx.clip(),this.ctx.drawImage(this.skill_b_img,i-t,e-t,2*t,2*t),this.ctx.restore(),this.ctx.beginPath(),this.ctx.moveTo(i,e),this.ctx.arc(i,e,t,0-Math.PI/2,-this.skill_b_coldtime/8*Math.PI*2-Math.PI/2,!0),this.ctx.fillStyle="rgba(0, 0, 255, 0.3)",this.ctx.fill(),this.skill_b_coldtime||(this.ctx.font=.05*this.playground.height+"px '微软雅黑'",this.ctx.fillStyle="rgba(45,12,19,1)",this.ctx.textAlign="center",this.ctx.fillText("B",i,e+s)))}let e=.5*this.playground.width-.08*this.playground.height,a=.93*this.playground.height;this.ctx.save(),this.ctx.beginPath(),this.ctx.arc(e,a,t,0,2*Math.PI,!1),this.ctx.clip(),this.ctx.drawImage(this.fireball_img,e-t,a-t,2*t,2*t),this.ctx.restore(),this.ctx.beginPath(),this.ctx.moveTo(e,a),this.ctx.arc(e,a,t,0-Math.PI/2,-this.fireball_coldtime/2*Math.PI*2-Math.PI/2,!0),this.ctx.fillStyle="rgba(0, 0, 255, 0.3)",this.ctx.fill(),this.fireball_coldtime||(this.ctx.font=.05*this.playground.height+"px '微软雅黑'",this.ctx.fillStyle="rgba(45,12,19,1)",this.ctx.textAlign="center",this.ctx.fillText("Q",e,a+s)),e+=.12*i,this.ctx.save(),this.ctx.beginPath(),this.ctx.arc(e,a,t,0,2*Math.PI,!1),this.ctx.clip(),this.ctx.drawImage(this.flash_img,e-t,a-t,2*t,2*t),this.ctx.restore(),this.ctx.beginPath(),this.ctx.moveTo(e,a),this.ctx.arc(e,a,t,0-Math.PI/2,-this.flash_coldtime/8*Math.PI*2-Math.PI/2,!0),this.ctx.fillStyle="rgba(0, 0, 255, 0.3)",this.ctx.fill(),this.flash_coldtime||(this.ctx.font=.05*this.playground.height+"px '微软雅黑'",this.ctx.fillStyle="rgba(45,12,19,1)",this.ctx.textAlign="center",this.ctx.fillText("F",e,a+s)),e+=.12*i,this.ctx.save(),this.ctx.beginPath(),this.ctx.arc(e,a,t,0,2*Math.PI,!1),this.ctx.clip(),this.ctx.drawImage(this.skill_r_img,e-t,a-t,2*t,2*t),this.ctx.restore(),this.ctx.beginPath(),this.ctx.moveTo(e,a),this.ctx.arc(e,a,t,0-Math.PI/2,-this.skill_r_coldtime/8*Math.PI*2-Math.PI/2,!0),this.ctx.fillStyle="rgba(0, 0, 255, 0.3)",this.ctx.fill(),this.skill_r_coldtime||(this.ctx.font=.05*this.playground.height+"px '微软雅黑'",this.ctx.fillStyle="rgba(45,12,19,1)",this.ctx.textAlign="center",this.ctx.fillText("R",e,a+s));let h=0;"shenli"===this.work?h=8:"hutao"===this.work&&(h=30),e+=.12*i,this.ctx.save(),this.ctx.beginPath(),this.ctx.arc(e,a,t,0,2*Math.PI,!1),this.ctx.clip(),this.ctx.drawImage(this.skill_d_img,e-t,a-t,2*t,2*t),this.ctx.restore(),this.ctx.beginPath(),this.ctx.moveTo(e,a),this.ctx.arc(e,a,t,0-Math.PI/2,-this.skill_d_coldtime/h*Math.PI*2-Math.PI/2,!0),this.ctx.fillStyle="rgba(0, 0, 255, 0.3)",this.ctx.fill(),this.skill_d_coldtime||(this.ctx.font=.05*this.playground.height+"px '微软雅黑'",this.ctx.fillStyle="rgba(45,12,19,1)",this.ctx.textAlign="center",this.ctx.fillText("D",e,a+s))}on_destory(){"me"===this.character&&("danren"===this.playground.mode&&"fighting"===this.playground.state&&this.playground.scoreboard.lose(),this.playground.state="over",this.playground.notice_board.write("You are over"));for(let t=0;t<this.playground.plays.length;t++){this===this.playground.plays[t]&&this.playground.plays.splice(t,1)}}fireball_destory(t){for(let i=0;i<this.fireballs.length;i++){let s=this.fireballs[i];if(s.uuid===t){s.destory();break}}}greenarrow_destory(t){for(let i=0;i<this.greenarrows.length;i++){let s=this.greenarrows[i];if(s.uuid===t){s.destory();break}}}}class ScoreBoard extends AcGameObject{constructor(t){super(),this.playground=t,this.ctx=this.playground.GameMap.ctx,this.state=null,this.win_img=new Image,this.win_img.src="https://cdn.acwing.com/media/article/image/2021/12/17/1_8f58341a5e-win.png",this.lose_img=new Image,this.lose_img.src="https://cdn.acwing.com/media/article/image/2021/12/17/1_9254b5f95e-lose.png"}start(){}add_listening_events(){let t=this;if(this.playground.GameMap){this.playground.GameMap.$canvas.on("click",(function(){t.playground.hide(),t.playground.root.menu.show()}))}}win(){this.state="win";let t=this;setTimeout((function(){t.add_listening_events()}),1e3)}lose(){this.state="lose";let t=this;setTimeout((function(){t.add_listening_events()}),1e3)}later_update(){this.render()}render(){let t=this.playground.height/2;"win"===this.state?this.ctx.drawImage(this.win_img,this.playground.width/2-t/2,this.playground.height/2-t/2,t,t):"lose"===this.state&&this.ctx.drawImage(this.lose_img,this.playground.width/2-t/2,this.playground.height/2-t/2,t,t)}}class CureBall extends AcGameObject{constructor(t,i,s,e,a,h,r){super(),this.playground=t,this.ctx=this.playground.GameMap.ctx,this.player=i,this.x=s,this.y=e,this.time=a,this.radius=h,this.color="rgba(150,194,78,0.5)",this.esp=.01,this.damage=.01,this.character=r}is_mode(t){if("danren"===this.playground.mode){if(this.player===t)return!0}else if("duoren"===this.playground.mode&&this.player.id%2==t.id%2)return!0;return!1}get_distance(t,i,s,e){let a=s-t,h=e-i;return Math.sqrt(a*a+h*h)}is_attack(t,i,s){return this.get_distance(t,i,this.x,this.y)<this.radius-s}attack(t,i){let s=Math.atan2(t.y-this.y,t.x-this.x);t.cureball_attacked(this.damage),"duoren"===this.playground.mode&&"player"===this.character&&this.playground.mps.send_attack(t.uuid,this.uuid,this.damage,s,t.x,t.y,"cureball")}update_attack(){for(let t=0;t<this.playground.plays.length;t++){let i=this.playground.plays[t];this.is_mode(i)&&this.is_attack(i.x,i.y,i.radius)&&this.attack(i,this.player)}}update(){this.time-=this.timedate/1e3,this.time<this.esp&&this.destory(),"enemy"!==this.player.character&&this.update_attack(),"System"===this.character&&this.update_attack(),this.render()}render(){if(!this.playground.foucs)return!1;let t=0,i=0;this.playground.focus_mode?(t=this.x-this.playground.plays[0].x+.5*this.playground.width/this.playground.scale,i=this.y-this.playground.plays[0].y+.5):(t=this.x-this.playground.focus_point_x+.5*this.playground.width/this.playground.scale,i=this.y-this.playground.focus_point_y+.5);let s=this.playground.scale;this.ctx.beginPath(),this.ctx.fillStyle=this.color,this.ctx.arc(t*s,i*s,this.radius*s,0,2*Math.PI,!1),this.ctx.fill()}}class FireBall extends AcGameObject{constructor(t,i,s,e,a,h,r,l,o){super(),this.angle=h,this.x=s,this.y=e,this.player=i,this.playground=t,this.speed=a,this.ctx=this.player.ctx,this.move_length=r,this.esp=.01,this.radius=l,this.damage=.01,this.player.fireballs.push(this),this.color=o,this.vx=Math.cos(h),this.vy=Math.sin(h)}out_of_map(t,i){if(t-this.radius<.1*this.esp||t+this.radius>this.playground.real_width-.1*this.esp)return!0;if(i-this.radius<.1*this.esp||i+this.radius>this.playground.real_height-.1*this.esp)return!0;if("duoren"===this.playground.mode){let s=this.playground.real_width/20,e=this.playground.GameMap.room_x,a=this.playground.GameMap.room_y;for(let h=0;h<e.length;h++)for(let r=0;r<8;r++){let l=2*Math.PI/8*r,o=t+Math.cos(l)*this.radius,n=i+Math.sin(l)*this.radius;if(e[h]<=o&&o<=e[h]+s&&a[h]<=n&&n<=a[h]+s)return!0}}return!1}is_mode(t){if("boss"===t.username)return!0;if("duoren"===this.playground.mode){if(t.id%2!=this.player.id%2)return!0}else if("danren"===this.playground.mode&&t!==this.player)return!0}get_distance(t,i,s,e){let a=s-t,h=e-i;return Math.sqrt(a*a+h*h)}is_attack(t,i,s,e){let a=this.get_distance(i,s,this.x,this.y);return"ai"===t.character&&a<2*t.radius&&Math.random()>.95&&(t.cur_skill="flash",t.is_flash=!0,t.flash_angle=this.angle+Math.PI/2),t.skill_r_time>this.esp&&a<.2+this.radius||a<e+this.radius}attack(t,i){let s=Math.atan2(t.y-this.y,t.x-this.x);t.skill_r_time<this.esp&&t.attacked(s,this.damage,i,"fireball"),"duoren"===this.playground.mode&&this.playground.mps.send_attack(t.uuid,this.uuid,this.damage,s,t.x,t.y,"fireball"),this.destory()}update_move(){if(this.move_length<this.esp)return this.destory(),!1;{let t=Math.min(this.move_length,this.speed*this.timedate/1e3);this.x+=this.vx*t,this.y+=this.vy*t,this.move_length-=t}}update_attack(){for(let t=0;t<this.playground.plays.length;t++){let i=this.playground.plays[t];this.is_mode(i)&&this.is_attack(i,i.x,i.y,i.radius)&&this.attack(i,this.player)}}update(){for(let t=0;t<20*Math.random()+10;t++){let t=Math.random()*Math.PI*2,i=.005*Math.random(),s=.05*Math.random(),e=.15;new FireWorks(this.playground,this,this.x,this.y,this.color,i,t,s,e)}if(this.out_of_map(this.x,this.y))return this.destory(),!1;"enemy"!==this.player.character&&this.update_attack(),this.update_move(),this.render()}render(){if(!this.playground.foucs)return!1;let t=0,i=0;this.playground.focus_mode?(t=this.x-this.playground.plays[0].x+.5*this.playground.width/this.playground.scale,i=this.y-this.playground.plays[0].y+.5):(t=this.x-this.playground.focus_point_x+.5*this.playground.width/this.playground.scale,i=this.y-this.playground.focus_point_y+.5);let s=this.playground.scale;this.ctx.beginPath(),this.ctx.arc(t*s,i*s,this.radius*s,0,2*Math.PI,!1),this.ctx.fillStyle=this.color,this.ctx.fill()}on_destory(){for(let t=0;t<this.player.fireballs.length;t++){if(this.player.fireballs[t]===this){this.player.fireballs.splice(t,1);break}}}}class GreenArrow extends AcGameObject{constructor(t,i,s,e,a,h,r,l){super(),this.playground=t,this.ctx=this.playground.GameMap.ctx,this.start_x=s,this.start_y=e,this.now_x=this.start_x,this.now_y=this.start_y,this.angle=r,this.move_length=h,this.vx=Math.cos(r),this.vy=Math.sin(r),this.color=l,this.speed=a,this.damage=.01,this.player=i,this.player.greenarrows.push(this),this.plan_player=[],this.esp=.01}is_mode(t){if("boss"===t.username)return!0;if("duoren"===this.playground.mode){if(t.id%2!=this.player.id%2)return!0}else if("danren"===this.playground.mode&&t!==this.player)return!0;return!1}start(){for(let t=0;t<this.playground.plays.length;t++)this.plan_player.push("0")}out_of_map(t,i){if(t<.1*this.esp||t>this.playground.real_width-.1*this.esp)return!0;if(i<.1*this.esp||i>this.playground.real_height-.1*this.esp)return!0;if("duoren"===this.playground.mode){let s=this.playground.real_width/20,e=this.playground.GameMap.room_x,a=this.playground.GameMap.room_y;for(let h=0;h<e.length;h++)if(e[h]<=t&&t<=e[h]+s&&a[h]<=i&&i<=a[h]+s)return!0}return!1}get_distance(t,i,s,e){let a=s-t,h=e-i;return Math.sqrt(a*a+h*h)}is_attack(t,i,s,e){let a=this.get_distance(i,s,this.now_x,this.now_y);return t.skill_r_time>this.esp&&a<.2||a<e}attack(t,i){let s=Math.atan2(t.y-this.now_y,t.x-this.now_x);t.skill_r_time<this.esp&&t.attacked(s,this.damage,i,"greenarrow"),"duoren"===this.playground.mode&&this.playground.mps.send_attack(t.uuid,this.uuid,this.damage,s,t.x,t.y,"greenarrow"),t.skill_r_time>this.esp&&this.destory()}update_attack(){for(let t=0;t<this.playground.plays.length;t++){let i=this.playground.plays[t];this.is_mode(i)&&this.is_attack(i,i.x,i.y,i.radius)&&"0"===this.plan_player[t]&&(this.attack(i,this.player),this.plan_player[t]="1")}}update(){"enemy"!==this.player.character&&this.update_attack(),this.update_move(),this.render()}update_move(){if(this.move_length<this.esp)return this.destory(),!1;{let t=Math.min(this.move_length,this.speed*this.timedate/1e3);this.now_x+=this.vx*t,this.now_y+=this.vy*t,this.move_length-=t}}render(){if(!this.playground.foucs)return!1;let t=0,i=0,s=0,e=0;this.playground.focus_mode?(s=this.start_x-this.playground.plays[0].x+.5*this.playground.width/this.playground.scale,e=this.start_y-this.playground.plays[0].y+.5,t=this.now_x-this.playground.plays[0].x+.5*this.playground.width/this.playground.scale,i=this.now_y-this.playground.plays[0].y+.5):(s=this.start_x-this.playground.focus_point_x+.5*this.playground.width/this.playground.scale,e=this.start_y-this.playground.focus_point_y+.5,t=this.now_x-this.playground.focus_point_x+.5*this.playground.width/this.playground.scale,i=this.now_y-this.playground.focus_point_y+.5);let a=this.playground.scale;this.ctx.beginPath(),this.ctx.strokeStyle=this.color,this.ctx.lineWidth=.01*this.playground.height,this.ctx.moveTo(s*a,e*a),this.ctx.lineTo(t*a,i*a),this.ctx.stroke(),this.ctx.closePath()}on_destory(){for(let t=0;t<this.player.greenarrows.length;t++){if(this.player.greenarrows[t]===this){this.player.greenarrows.splice(t,1);break}}}}class MultiplayerSocket{constructor(t){this.playground=t,this.ws=new WebSocket("wss://www.lijiamiao.top/wss/multiplayer/"),this.start()}start(){this.receive()}receive(){let t=this;this.ws.onmessage=function(i){let s=JSON.parse(i.data),e=s.uuid;if(e===t.uuid)return!1;let a=s.event;"create_player"===a?t.receive_create_player(e,s.username,s.photo,s.id,s.work):"move_to"===a?t.receive_move_to(e,s.tx,s.ty):"fireball"===a?t.receive_fireball(e,s.tx,s.ty,s.ball_uuid,s.events):"attack"===a?t.receive_attack(e,s.attacked_uuid,s.ball_uuid,s.damage,s.angle,s.x,s.y,s.events):"flash"===a?t.receive_flash(e,s.angle):"chat"===a?t.receive_chat(s.massage,s.id,s.mode):"create_boss"===a?t.receive_create_boss(e,s.username,s.photo,s.id,s.state):"move_boss"===a&&t.receive_move_boss(e,s.angle,s.move_length)}}search_player(t){for(let i=0;i<this.playground.plays.length;i++){let s=this.playground.plays[i];if(s.uuid===t)return s}return null}send_create_player(t,i,s){this.ws.send(JSON.stringify({event:"create_player",uuid:this.uuid,username:t,photo:i,work:s}))}receive_create_player(t,i,s,e,a){let h=new Player(this.playground,this.playground.real_width/2,this.playground.real_height/2,.15,.05,"white","enemy",i,s,e,a);h.uuid=t,this.playground.plays.push(h)}receive_create_boss(t,i,s,e,a){this.playground.notice_board.write("Fighting");let h=this.playground.real_width/20,r=[2*h,3-2*h],l=[3-2*h,2*h],o=a,n=new Player(this.playground,r[o],l[o],.15,.1,"white","enemy",i,s,e);n.start_x=r[o],n.start_y=l[o],n.uuid=t,this.playground.plays.push(n)}send_move_to(t,i){this.ws.send(JSON.stringify({event:"move_to",uuid:this.uuid,tx:t,ty:i}))}receive_move_to(t,i,s){let e=this.search_player(t);e&&e.move_to(i,s)}receive_move_boss(t,i,s){let e=this.search_player(t);if(e){let t=this.playground.real_width/20,a=2*Math.PI*i,h=1.5*t*s,r=e.start_x+Math.cos(a)*h,l=e.start_y+Math.sin(a)*h;e.move_to(r,l)}}send_fireball(t,i,s,e){this.ws.send(JSON.stringify({event:"fireball",uuid:this.uuid,tx:t,ty:i,ball_uuid:s,events:e}))}receive_fireball(t,i,s,e,a){let h=this.search_player(t);if(h)if("fireball"===a){h.shoot_fireball(i,s,.8,"rgba(250,93,25,0.8)").uuid=e}else if("greenarrow"===a){h.shoot_greenarrow(i,s).uuid=e}else if("guangdun"===a)h.skill_b_time>h.esp&&(h.skill_b_time=0),h.skill_r_time=3;else if("cureball"===a){h.shoot_cureball(i,s).uuid=e}else"return_home"===a?(h.skill_b_time=3,h.vx=h.vy=h.move_length=0):"stay"===a&&(h.vx=h.vy=h.move_length=0)}send_attack(t,i,s,e,a,h,r){this.ws.send(JSON.stringify({event:"attack",uuid:this.uuid,attacked_uuid:t,ball_uuid:i,damage:s,angle:e,x:a,y:h,events:r}))}receive_attack(t,i,s,e,a,h,r,l){let o=this.search_player(t),n=this.search_player(i);o&&n&&n.receive_attacked(o,s,a,e,h,r,l)}send_flash(t){this.ws.send(JSON.stringify({event:"flash",uuid:this.uuid,angle:t}))}receive_flash(t,i){let s=this.search_player(t);s&&s.flash(i)}send_chat(t,i,s){this.ws.send(JSON.stringify({event:"chat",uuid:this.uuid,massage:t,id:i,mode:s}))}receive_chat(t,i,s){1===s&&this.playground.chatitem.render_massage(t),0===s&&i===this.playground.chatitem.player_id&&this.playground.chatitem.render_massage(t)}}class TimeBoard extends AcGameObject{constructor(t){super(),this.playground=t,this.ctx=this.playground.GameMap.ctx,this.time=360,this.esp=.01}update(){this.time>this.esp?(this.time-=this.timedate/1e3,this.time>180-this.esp&&this.time<190+this.esp&&this.playground.notice_board.write("河道之灵刷新"+Math.floor(this.time-180)+"秒")):this.time=0,this.render()}render(){let t=this.playground.real_width/8,i=this.playground.scale;this.ctx.fillStyle="rgba(0,0,0,0.4)",this.ctx.fillRect(this.playground.width-t*i-.1*this.playground.width,0,.1*this.playground.width,.2*this.playground.height),this.ctx.font=.05*this.playground.height+"px '微软雅黑'",this.ctx.fillStyle="rgba(45,12,19,1)",this.ctx.textAlign="center";let s=Math.floor(this.time/60),e=Math.floor(this.time)%60;e<10&&(e="0"+e),this.ctx.fillText(s+" : "+e,this.playground.width-t*i-.05*this.playground.width,.15*this.playground.height)}}class AcgamePlayground{constructor(t){this.root=t,this.$playground=$('<div class = "ac_game_playground" ></div>'),this.hide(),this.start()}create_uuid(){let t="";for(let i=0;i<8;i++){t+=parseInt(Math.floor(10*Math.random()))}return t}start(){let t=this,i=this.create_uuid();$(window).on(`resize.${i}`,(function(){t.resize(),t.chatitem&&t.chatitem.resize()})),this.root.acwingos&&this.root.acwingos.api.window.on_close((function(){t.hide(),$(window).off(`resize.${i}`)}))}get_random_color(){let t=["green","pink","red","blue","yellow","gray","purple","gold"];return t[Math.floor(Math.random()*t.length)]}resize(){this.width=this.$playground.width(),this.height=this.$playground.height();let t=Math.min(this.height/9,this.width/16);this.height=9*t,this.width=16*t,this.scale=this.height,this.real_width=this.real_height=3}show(){let t=this;if(this.root.$ac_game.append(this.$playground),this.resize(),this.player_cnt=0,this.foucs=null,this.state="waiting",this.plays=[],this.GameMap=new GameMap(this),this.notice_board=new NoticeBoard(this),this.plays.push(new Player(this,this.real_width/2,this.real_height/2,.15,.05,"white","me",t.root.settings.username,t.root.settings.photo,null,this.work)),this.foucs=this.plays[0],this.focus_point_x=0,this.focus_point_y=0,this.focus_mode=1,this.min_map=new MinMap(this,this.GameMap.ctx),this.scoreboard=new ScoreBoard(this),"danren"===this.mode)for(let t=0;t<5;t++)this.plays.push(new Player(this,this.real_width/2,this.real_height/2,.15,.05,this.get_random_color(),"ai",null,null,t));else"duoren"===this.mode&&(this.chatitem=new ChatItem(this),this.mps=new MultiplayerSocket(this),this.mps.uuid=this.plays[0].uuid,this.kill_cnt=[0,0],this.mps.ws.onopen=function(){t.mps.send_create_player(t.root.settings.username,t.root.settings.photo,t.work)});this.$playground.show()}hide(){for(this.is_doing=!1;this.plays&&this.plays.length>0;)this.plays[0].destory(),this.foucs=null;this.GameMap&&(this.GameMap.destory(),this.GameMap=null),this.notice_board&&(this.notice_board.destory(),this.notice_board=null),this.scoreboard&&(this.scoreboard.destory(),this.scoreboard=null),this.min_map&&(this.min_map.destory(),this.min_map=null),this.$playground.hide(),this.$playground.empty()}}class AcgameSettings{constructor(t){"https://app1697.acapp.acwing.com.cn"===window.location.host&&window.location.replace("https://www.lijiamiao.top"),this.root=t,this.photo="",this.platform="web",this.root.acwingos&&(this.platform="acapp"),this.$settings=$('\n<div class = "ac_game_settings">\n    <div class ="ac_game_settings_login">\n        <div class = "ac_game_settings_title">\n            登录\n        </div>\n        <div class="ac_game_settings_username">\n            <div class="ac_game_settings_item">\n                <input type ="text" placeholder="用户名">\n            </div>\n        </div>\n        <div class="ac_game_settings_password">\n            <div class="ac_game_settings_item">\n                <input type="password" placeholder="密码">\n            </div>\n        </div>\n        <div class="ac_game_settings_submit">\n            <div class="ac_game_settings_item">\n                <button>登录</button>\n            </div>\n        </div>\n        <div class ="ac_game_settings_error_message">\n        </div>\n        <div class="ac_game_settings_option">\n            注册\n        </div>\n        <br>\n        <div class = "ac_game_settings_acwing">\n            <img width = "30" src="https://www.lijiamiao.top/static/image/playground/playground.png">\n            <br>\n            <br>\n            <div>\n                Acwing 一键登录\n            </div>\n        </div>\n     </div>\n     <div class ="ac_game_settings_register">\n        <div class = "ac_game_settings_title">\n            注册\n        </div>\n        <div class="ac_game_settings_username">\n            <div class="ac_game_settings_item">\n                <input type ="text" placeholder="用户名">\n            </div>\n        </div>\n        <div class="ac_game_settings_password ac_game_settings_password_first">\n            <div class="ac_game_settings_item">\n                <input type="password" placeholder="密码">\n            </div>\n        </div>\n        <div class="ac_game_settings_password ac_game_settings_password_second">\n            <div class="ac_game_settings_item">\n                <input type="password" placeholder="确认密码">\n            </div>\n        </div>\n        <div class="ac_game_settings_submit">\n            <div class="ac_game_settings_item">\n                <button>立即注册</button>\n            </div>\n        </div>\n        <div class ="ac_game_settings_error_message">\n        </div>\n        <div class="ac_game_settings_option">\n            登录\n        </div>\n        <br>\n        <div class = "ac_game_settings_acwing">\n            <img width = "30" src="https://www.lijiamiao.top/static/image/playground/playground.png">\n            <br>\n            <br>\n            <div>\n                Acwing 一键登录\n            </div>\n        </div>\n    </div>\n\n</div>\n\n'),this.$login=this.$settings.find(".ac_game_settings_login"),this.$login_username=this.$login.find(".ac_game_settings_username input"),this.$login_password=this.$login.find(".ac_game_settings_password input"),this.$login_error_message=this.$login.find(".ac_game_settings_error_message"),this.$login_option=this.$login.find(".ac_game_settings_submit button"),this.$login_register=this.$login.find(".ac_game_settings_option"),this.$login.hide(),this.$register=this.$settings.find(".ac_game_settings_register"),this.$register_username=this.$register.find(".ac_game_settings_username input"),this.$register_password_first=this.$register.find(".ac_game_settings_password_first input"),this.$register_password_second=this.$register.find(".ac_game_settings_password_second input"),this.$register_error_message=this.$register.find(".ac_game_settings_error_message"),this.$register_submit=this.$register.find(".ac_game_settings_submit button"),this.$register_login=this.$register.find(".ac_game_settings_option"),this.$register.hide(),this.$acwing_login=this.$settings.find(".ac_game_settings_acwing img"),this.root.$ac_game.append(this.$settings),this.start()}start(){"web"===this.platform?(this.web_getinfo(),this.add_listening_events()):"acapp"===this.platform&&this.acapp_getinfo()}add_listening_events(){let t=this;this.add_listening_events_login(),this.add_listening_events_register(),this.$acwing_login.click((function(){t.web_acwing_login()}))}add_listening_events_login(){let t=this;this.$login_register.click((function(){t.register()})),this.$login_option.click((function(){t.remote_login()}))}add_listening_events_register(){let t=this;this.$register_login.click((function(){t.login()})),this.$register_submit.click((function(){t.remote_register()}))}web_acwing_login(){$.ajax({url:"https://www.lijiamiao.top/settings/acwing/web/apply_code/",type:"GET",success:function(t){"success"===t.result&&window.location.replace(t.redirect_acwing_url)}})}remote_login(){let t=this;$.ajax({url:"https://www.lijiamiao.top/settings/login/",type:"GET",data:{username:t.$login_username.val(),password:t.$login_password.val()},success:function(i){"success"===i.result?location.reload():t.$login_error_message.html(i.result)}})}remote_register(){let t=this;$.ajax({url:"https://www.lijiamiao.top/settings/register/",type:"GET",data:{username:t.$register_username.val(),password_first:t.$register_password_first.val(),password_second:t.$register_password_second.val()},success:function(i){"success"===i.result?location.reload():t.$register_error_message.html(i.result)}})}remote_logout(){$.ajax({url:"https://www.lijiamiao.top/settings/logout/",type:"GET",success:function(t){"success"===t.result&&location.reload()}})}register(){this.$login.hide(),this.$register.show()}login(){this.$register.hide(),this.$login.show()}web_getinfo(){let t=this;$.ajax({url:"https://www.lijiamiao.top/settings/getinfo/",type:"GET",data:{platform:t.platform},success:function(i){"success"===i.result?(t.username=i.username,t.photo=i.photo,t.hide(),t.root.menu.show()):t.login()}})}acwing_login(t,i,s,e){let a=this;this.root.acwingos.api.oauth2.authorize(t,i,s,e,(function(t){"success"===t.result&&(a.username=t.username,a.photo=t.photo,a.hide(),a.root.menu.show())}))}acapp_getinfo(){let t=this;$.ajax({url:"https://www.lijiamiao.top/settings/acwing/acapp/apply_code",type:"GET",success:function(i){"success"===i.result&&t.acwing_login(i.appid,i.redirect_uri,i.scope,i.state)}})}hide(){this.$settings.hide()}}export class AcGame{constructor(t,i){this.id=t,this.$ac_game=$("#"+t),this.acwingos=i,this.settings=new AcgameSettings(this),this.choose_character=new ChooseCharacter(this),this.playground=new AcgamePlayground(this),this.menu=new AcgameMenu(this),this.$menu_bgm_item=$('\n<audio class="ac-game-menu-bgm" src="https://www.lijiamiao.top/static/audio/menu/menu.mp3" preload="auto" autoplay="autoplay" loop="loop"></audio>\n'),this.$menu_bgm=document.getElementsByClassName("ac-game-menu-bgm")[0],this.$ac_game.append(this.$menu_bgm_item),this.$menu_bgm_item.show()}}
